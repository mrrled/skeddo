<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:lessons="clr-namespace:newUI.Views.LessonCard"
             xmlns:schedule="clr-namespace:newUI.ViewModels.Schedule"
             xmlns:dto="clr-namespace:Application.DtoModels;assembly=Application"
             xmlns:lessonViewModel="clr-namespace:newUI.ViewModels.Lessons"
             xmlns:helper="clr-namespace:newUI.ViewModels.Helpers"
             x:Class="newUI.Views.ScheduleTable.Table"
             x:DataType="schedule:LessonTableViewModel"
             x:Name="TableRoot">

    <ScrollViewer HorizontalScrollBarVisibility="Auto"
                  VerticalScrollBarVisibility="Auto">

        <Grid ColumnDefinitions="120, *"
              RowDefinitions="Auto, *">

            <!-- Заголовки столбцов -->
            <ItemsControl Grid.Row="0" Grid.Column="1"
                          ItemsSource="{Binding Columns}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <StackPanel Orientation="Horizontal"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate x:DataType="dto:StudyGroupDto">
                        <Border MinWidth="180"
                                Background="#F0F0F0"
                                BorderBrush="#CCCCCC"
                                BorderThickness="1 1 1 0"
                                Padding="5">
                            <TextBlock Text="{Binding Name}"
                                       HorizontalAlignment="Center"
                                       FontWeight="Bold"/>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>

            <!-- Левая колонка -->
            <Border Grid.Row="0" Grid.Column="0"
                    Background="#E0E0E0"
                    BorderBrush="#CCCCCC"
                    BorderThickness="1 1 0 0"
                    Padding="5">
                <TextBlock Text="№ Урока"
                           HorizontalAlignment="Center"
                           FontWeight="Bold"/>
            </Border>

            <!-- Строки -->
            <ItemsControl Grid.Row="1" Grid.ColumnSpan="2"
                          ItemsSource="{Binding Rows}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Grid ColumnDefinitions="120, *">

                            <!-- Заголовок строки -->
                            <Border Grid.Column="0"
                                    BorderBrush="#CCCCCC"
                                    BorderThickness="1 0 1 1"
                                    Padding="5"
                                    Background="#F8F8F8"
                                    MinHeight="150">
                                <TextBlock Text="{Binding RowHeader.Number}"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center"/>
                            </Border>

                            <!-- Ячейки -->
                            <ItemsControl Grid.Column="1"
                                          ItemsSource="{Binding $parent[UserControl].DataContext.Columns}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <StackPanel Orientation="Horizontal"/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>

                                <ItemsControl.ItemTemplate>
                                    <DataTemplate x:DataType="dto:StudyGroupDto">

                                        <!-- Контейнер ячейки -->
                                        <Border MinWidth="180" MinHeight="150"
                                                BorderBrush="#CCCCCC"
                                                BorderThickness="0 0 1 1"
                                                Background="White">

                                            <ContentControl Content="{Binding $parent[ItemsControl].DataContext}">
                                                <ContentControl.DataContext>
                                                    <MultiBinding Converter="{StaticResource CellResolver}">
                                                        <Binding Path="$parent[ItemsControl].DataContext"/> <!-- row -->
                                                                                              <!-- column -->
                                                    </MultiBinding>
                                                </ContentControl.DataContext>
                                            </ContentControl>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </Grid>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>

        </Grid>
    </ScrollViewer>
</UserControl>
